name: Windows
on:
  push:
    branches:
    - staging
    tags:
    - v.*
jobs:
  Packaging:
    runs-on: windows-latest
    steps:
    - uses: actions/checkout@v1
    - uses: actions/setup-node@v1
    - name: Building ASAR
      run: |
        npm ci --no-optional
        npm run package:win -- --asar
    - name: Building non-ASAR for squirrel
      run: |
        npm run package:win-squirrel
    - name: Creating Squirrel Windows Installer
      run: npx electron-installer-windows --src 'release-builds/time-to-leave-win32-ia32' --dest 'squirrel-release'
    - name: Uploading Installer
      uses: actions/upload-artifact@v1.0.0
      with:
        name: 'Time to Leave Installer'
        path: 'squirrel-release/time_to_leave-1.3.0-setup.exe'
    - name: Uploading Package
      uses: actions/upload-artifact@v1.0.0
      with:
        name: 'Time to Leave App'
        path: 'release-builds\Time to Leave-win32-ia32\Time to Leave.exe'
      env:
        CI: true
